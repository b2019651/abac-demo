以循序漸進的方式，為初學者解釋不同權限系統的核心概念。從最簡單但有缺陷的角色檢查開始，逐步引導到角色型存取控制（RBAC），最後介紹功能最強大的屬性型存取控制（ABAC）。目標是讓學習者理解每個系統解決了什麼問題，以及為何需要更複雜的系統來應對真實世界的應用場景。

# 從 RBAC 到 ABAC：深入解析現代權限系統的演進之路

## 簡介

權限管理是所有應用程式開發中最核心、也最具挑戰性的環節之一。
一個設計不良的權限系統，不僅帶來安全漏洞，也會隨著業務複雜化而難以維護。

本文件將從開發者常犯的錯誤切入，逐步介紹：

- **角色型存取控制 (RBAC)**
- **屬性型存取控制 (ABAC)**

並理解它們之間的演化關係與適用場景。

---

## 1️⃣ 起點的謬誤：為何直接檢查「角色」是個壞主意？

### 初始做法示例

假設：只有 **admin** 能刪除留言

```js
// 一個常見但有問題的寫法
if (user.role === "admin") {
  // 顯示刪除按鈕
}
```

### 需求變更 → 問題擴大

- 版主 (moderator) 也能刪除
- 使用者能刪除自己的留言

程式碼變成這樣：

```js
// 邏輯迅速失控 (spirals out of control)
if (user.role === "admin" || user.role === "moderator") {
  // 顯示刪除按鈕
} else if (user.id === comment.authorId) {
  // 顯示刪除按鈕
}
```

> **問題點**：角色判斷 + 資源所有權邏輯混在一起，造成難以維護。

### 核心缺陷

| 缺陷        | 描述                                  |
| ----------- | ------------------------------------- |
| ❌ 難以維護 | 修改需求 → 需要搜尋專案所有判斷並調整 |
| ❌ 邏輯分散 | 權限判斷散落整個程式碼庫              |
| ❌ 缺乏彈性 | 遇到更細緻規則就會崩壞                |

---

## 2️⃣ 角色型存取控制 (RBAC)：第一個里程碑

### 核心轉變

> 從檢查 _使用者是什麼角色_ ➜ 檢查 _使用者是否擁有權限_

#### 權限集中管理範例

```js
const roles = {
  admin: {
    permissions: ["create:comments", "update:comments", "delete:comments"],
  },
  moderator: {
    permissions: ["update:comments", "delete:comments"],
  },
  user: {
    permissions: ["create:comments"],
  },
};
```

#### 業務邏輯更乾淨

```js
if (hasPermission(user, "delete:comments")) {
  // 顯示刪除按鈕
}
```

### RBAC vs 直接檢查角色

| 特性     | 直接檢查角色 | RBAC            |
| -------- | ------------ | --------------- |
| 管理方式 | 分散各處     | 集中設定檔或 DB |
| 耦合度   | 高           | 低              |
| 維護性   | 差           | 好              |

### RBAC 的侷限性

無法自然處理：

- 使用者只能修改自己的留言
- 文件已發布後無法刪除
- 依據狀態/關係/地理位置等動態條件

於是開發者又開始回寫判斷邏輯 → **RBAC 還不夠**

---

## 3️⃣ 屬性型存取控制 (ABAC)：終極解法

### 核心思想

> 不只角色，而是考慮多種「屬性」動態計算決策

ABAC 判斷依據包含：

| 屬性類型      | 說明           | 範例                     |
| ------------- | -------------- | ------------------------ |
| 主體 Subject  | 使用者資料     | userId、roles、blockedBy |
| 資源 Resource | 被操作物件資訊 | authorId、status         |
| 操作 Action   | 例如 CRUD      | view、create、delete     |
| 環境 Context  | 其他情境因素   | IP、時間、裝置、組織     |

### RBAC vs ABAC 思維差異

| 觀點     | RBAC                 | ABAC                     |
| -------- | -------------------- | ------------------------ |
| 權限形式 | 靜態列表             | 動態規則函式             |
| 問題形式 | 是否存在某權限字串？ | 按規則動態決策是否允許？ |

### ABAC 範例情境

- 版主可以刪除**已完成**的待辦事項
- 使用者可以查看留言，只要作者**沒有封鎖他**
- 協作者可以更新他人建立的文件

> ✔ 細粒度授權
> ✔ 動態決策
> ✔ 更貼近真實世界規則

---

## RBAC vs ABAC 總比較

| 特性     | RBAC           | ABAC                     |
| -------- | -------------- | ------------------------ |
| 定義方式 | 靜態角色權限表 | 動態屬性規則             |
| 判斷依據 | 「角色」       | 「四種屬性」             |
| 靈活性   | 中             | 極高                     |
| 適用範圍 | 組織型角色固定 | 共享、協作、情境感知系統 |

---

## 4️⃣ 結論：該如何選擇？

### 建議指南

| 情境                                         | 適用模型 |
| -------------------------------------------- | -------- |
| 權限主要依角色區分，變化不大                 | RBAC     |
| 權限需依資源屬性、使用者關係、狀態或情境決策 | ABAC     |

---

### 最終洞見

> 沒有最好的權限模型，只有最適合的。

若你能預見：

- 權限將依資料狀態變動
- 使用者之間關係將越來越複雜
- 需要未來可擴充性

➡ **建議從一開始就採用 ABAC 架構**

因為重構權限系統，是所有架構師最不想面對的惡夢。
